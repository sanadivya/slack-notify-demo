echo "üì£ Sending slack notification..."
        echo "üîç Detecting merged PR for commit: $$COMMIT_SHA"

        PR_DATA=$(curl -s -H "Authorization: token $$GITHUB_TOKEN" \
            "https://api.github.com/search/issues?q=sha:$$COMMIT_SHA+repo:sanadivya/slack-notify-demo+is:pr")
        PR_NUMBER=$(echo "$$PR_DATA" | jq -r '.items[0].number')
        PR_DETAILS=$(curl -s -H "Authorization: token $$GITHUB_TOKEN" \
            "https://api.github.com/repos/sanadivya/slack-notify-demo/pulls/$$PR_NUMBER")

        PR_COUNT=$(echo "$$PR_DATA" | jq 'length')

        PR_NUMBER=$(echo "$$PR_DATA" | jq -r '.number')
        PR_TITLE=$(echo "$$PR_DATA" | jq -r '.title')
        PR_SOURCE=$(echo "$$PR_DATA" | jq -r '.head.ref')
        PR_TARGET=$(echo "$$PR_DATA" | jq -r '.base.ref')
        PR_DESCRIPTION=$(echo "$$PR_DATA" | jq -r '.body')

        echo "$${PR_NUMBER}"
        echo "$${PR_TITLE}"
        echo "$${PR_SOURCE}"
        echo "$${PR_TARGET}"
        echo "$${PR_DESCRIPTION}"

        if [ "$$PR_DESCRIPTION" = "null" ] || [ -z "$$PR_DESCRIPTION" ]; then
          PR_DESCRIPTION="-"
        fi

        PR_AUTHOR_LOGIN=$(echo "$$LATEST_PR_DATA" | jq -r '.user.login')

        echo "$${PR_AUTHOR_LOGIN}"

        PR_AUTHOR_NAME=$(curl -s -H "Authorization: token $$GITHUB_TOKEN" \
          "https://api.github.com/users/$${PR_AUTHOR_LOGIN}" | jq -r '.name')

        if [ "$$PR_AUTHOR_NAME" = "null" ] || [ -z "$$PR_AUTHOR_NAME" ]; then
          PR_AUTHOR_NAME="@$${PR_AUTHOR_LOGIN}"
        fi

        PR_DESCRIPTION_FORMATTED=$(echo "$${PR_DESCRIPTION}" | sed 's/^/  /' | sed ':a;N;$!ba;s/\n/\\n/g')

        DETAILS="\n- **PR Title**: $${PR_TITLE}\\n- **PR Number**: #$${PR_NUMBER}\\n- **PR Description**: \\n$${PR_DESCRIPTION_FORMATTED}\\n- **PR Author**: $${PR_AUTHOR_NAME}"
        ESCAPED_DETAILS=$(printf '%s' "$${DETAILS}" | jq -R | jq -s -r 'join("\\n")')

        echo "$${DETAILS}"
        echo "$${ESCAPED_DETAILS}"


            args:
      - '-c'
      - |
        echo "üîç Setting up..."
        echo "üì¶ Installing curl jq..."
        apt-get update && apt-get install -y curl jq git

        git fetch --unshallow || true

        COMMIT_SHA=$(git rev-parse HEAD)

        PARENT_COMMITS=$(git rev-list --parents -n 1 $$COMMIT_SHA)
        BEFORE_SHA=$(echo $$PARENT_COMMITS | cut -d' ' -f2)

        echo "AFTER_SHA: $$COMMIT_SHA"
        echo "BEFORE_SHA: $$BEFORE_SHA"

        git fetch --unshallow 2>/dev/null || git fetch --depth=2

        AFTER_SHA=$(git rev-parse HEAD)

        PARENT_COMMITS=$(git rev-list --parents -n 1 $$AFTER_SHA)
        BEFORE_SHA=$(echo $$PARENT_COMMITS | cut -d' ' -f2)

        echo "AFTER_SHA: $$AFTER_SHA"
        echo "BEFORE_SHA: $$BEFORE_SHA"

        echo "Fetching commit info..."
        COMMIT_API="https://api.github.com/repos/sanadivya/slack-notify-demo/commits/$$COMMIT_SHA"
        COMMIT_DATA=$(curl -s -H "Authorization: token $$SLACK_GITHUB_TOKEN" "$$COMMIT_API")
        COMMIT_MESSAGE=$(echo "$$COMMIT_DATA" | jq -r '.commit.message')
        COMMIT_AUTHOR=$(echo "$$COMMIT_DATA" | jq -r '.commit.author.name')

        set -x

        echo "üì£ Sending slack notification..."
        echo "üîç Detecting merged PR for commit: $$COMMIT_SHA"

        PR_DATA=$(curl -s -H "Authorization: token $$GITHUB_TOKEN" \
            "https://api.github.com/search/issues?q=sha:$$COMMIT_SHA+repo:sanadivya/slack-notify-demo+is:pr")
        PR_NUMBER=$(echo "$$PR_DATA" | jq -r '.items[0].number')
        PR_DETAILS=$(curl -s -H "Authorization: token $$GITHUB_TOKEN" \
            "https://api.github.com/repos/sanadivya/slack-notify-demo/pulls/$$PR_NUMBER")

        PR_COUNT=$(echo "$$PR_DATA" | jq 'length')

        PR_NUMBER=$(echo "$$PR_DATA" | jq -r '.number')
        PR_TITLE=$(echo "$$PR_DATA" | jq -r '.title')
        PR_SOURCE=$(echo "$$PR_DATA" | jq -r '.head.ref')
        PR_TARGET=$(echo "$$PR_DATA" | jq -r '.base.ref')
        PR_DESCRIPTION=$(echo "$$PR_DATA" | jq -r '.body')

        echo "$${PR_NUMBER}"
        echo "$${PR_TITLE}"
        echo "$${PR_SOURCE}"
        echo "$${PR_TARGET}"
        echo "$${PR_DESCRIPTION}"